<!DOCTYPE html>
<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="UTF-8">
        <title>
            Formulario
        </title>
        <style>
            h1{
                margin-top: 5%;
                margin-bottom: 5%;
                text-align: center;
            }

            label{
                font-size: 30px;
            }

            button{margin-right: 5px;}

            .list{
                margin-left: 5%;
                margin-right: 5%;
                padding-left: 3%;
                
            }
            @media all and (max-width:1668px) {
            
            /* .list{
                overflow-x:auto;
            } */
            }
              
            @media all and (max-width:1200px){
                #lemail{
                    margin-right: 40px;
                }
            }

  
            
        </style>
    </head>
    <body onload="getData()">
        <div class="container text-center"  >
            <div class="form">
                <h1>Formulario</h1>
                
                    <div class="form">
                        <form onsubmit="addRow();" id="form" class="form" >
                       
                            <div class="row col-sm-5 mx-auto ">
                                <div class="col form-group">
                                    <label for="name">Nombre</label>
                                    <input id="name"  type="text" placeholder="Jonh" required>
                                    <label for="lastName">Apellido</label>
                                    <input id="lastName"  type="text" placeholder="doe" required>
                                </div>
                                <div class="col form-group">
                                    <label id="lemail" for="email">Email</br></label>
                                    <input type="email" id="email" name="email" placeholder="jonhdoe@mail.com" required>
                                    <label for="Tel">Telefono</label>
                                    <input id="telefono" type="Tel" placeholder="8091111111" pattern="[0-9]{3}[0-9]{3}[0-9]{4}">
                                </div>
                              </div>

                              
                            <br>
                            <input type="submit" name="submit" value="submit" id="submit" class="btn btn-success btn-lg">
                            <input type="reset" name="reset" value="reset" id="reset" onclick="resetear()" class="btn btn-secondary btn-lg">
                        </form>
                    </div>
            </div>
           


        </div>
       
        <div class="container-fluid">
            <div class="list">
                <h1>Informacion</h1>
                
                <table class="table table-striped ">
                <thead>
                    <tr class="row justify-content-md-center " >
                        <th class="col align-self-center">Nombre</th>
                        <th class="col align-self-center">Apellido</th>
                        <th class="col align-self-center">Email</th>
                        <th class="col align-self-center">Telefono</th>
                        <th class="col align-self-center">Acciones</th>          
                    </tr>
                </thead>  
                
                <tbody id="lista">


                </tbody>
                
                </table>
            </div>
        
        </div>
          

    </div>
    </body>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
        var arr = [];
        let i = null;
        let rowPicker=null;
        const lista = document.getElementById("lista");
        const form = document.getElementById("form")
        const inputName = document.getElementById("name");
        const inputLastName= document.getElementById("lastName");
        const inputEmail= document.getElementById("email");
        const inputTelefono= document.getElementById("telefono");
        const btnSubmit= document.getElementById("submit");
        const btnReset = document.getElementById("reset")
        

        
   
        function getData(){
            var row = localStorage.getItem("localData");
            if(row !== null){
            arr = JSON.parse(row)
            setOnTableData()
        }
    }

        function setOnTableData()
        {
            arr.forEach(entrada => {
                var newRow = lista.insertRow(-1);
                newRow.setAttribute("class", "row")

                    var insertName = newRow.insertCell(0);
                    insertName.setAttribute("class", "col")
                    var insertLastName= newRow.insertCell(1);
                    insertLastName.setAttribute("class", "col")
                    var insertEmail = newRow.insertCell(2);
                    insertEmail.setAttribute("class", "col")
                    var insertTel = newRow.insertCell(3);
                    insertTel.setAttribute("class", "col")


                            //boton Eliminar
                    var buttonDelete = document.createElement("button");
                    buttonDelete.setAttribute("onclick", "deleteRow(this)")
                    buttonDelete.setAttribute("class", "btn btn-danger")
                    buttonDelete.innerHTML = "Eliminar"

                    //boton Modificar
                    var buttonEdit =  document.createElement("button");
                    buttonEdit.setAttribute("onclick", "editRowValues(this)")
                    buttonEdit.setAttribute("class", "btn btn-warning")
                    buttonEdit.innerHTML= "Modificar"
                    var insertButtons = newRow.insertCell(4)
                    insertButtons.setAttribute("class", "col")

                    //pegar los botones en la celda
                    insertButtons.append(buttonDelete, buttonEdit);


                    //insertar la informacion en la celdas
                        insertName.innerHTML= entrada.name;
                        insertLastName.innerHTML=entrada.lastName;
                        insertEmail.innerHTML=entrada.email;
                        insertTel.innerHTML=entrada.tel;
                 
            });
            

        }

        function addDataOnLocalStorage(){
            arr.push({
                name:inputName.value,
                lastName:inputLastName.value,
                email:inputEmail.value,
                tel:inputTelefono.value
            })


            localStorage.setItem("localData", JSON.stringify(arr))
        }
      
        function addRow() {
           
            //crear la columna y introducir las celdas;
            var newRow = lista.insertRow(-1);
            newRow.setAttribute("class", "row")
            var insertName = newRow.insertCell(0);
            insertName.setAttribute("class", "col")
            var insertLastName= newRow.insertCell(1);
            insertLastName.setAttribute("class", "col")
            var insertEmail = newRow.insertCell(2);
            insertEmail.setAttribute("class", "col")
            var insertTel = newRow.insertCell(3);
            insertTel.setAttribute("class", "col")
            

            //crear los botones y asignarlos a una celda

            //boton Eliminar
            var buttonDelete = document.createElement("button");
            buttonDelete.setAttribute("onclick", "deleteRow(this)")
            buttonDelete.setAttribute("class", "buttonDelete")
            buttonDelete.innerHTML = "Eliminar"

            //boton Modificar
            var buttonEdit =  document.createElement("button");
            buttonEdit.setAttribute("onclick", "editRowValues(this)" )
            buttonEdit.setAttribute("class", "buttonEdit")
            buttonEdit.innerHTML= "Modificar"
            var insertButtons = newRow.insertCell(4)
            insertButtons.setAttribute("class", "cell")
            //pegar los botones en la celda
            insertButtons.append(buttonDelete, buttonEdit);
           

            //insertar la informacion en la celdas
            
            insertName.innerHTML= inputName.value;
            insertLastName.innerHTML=inputLastName.value;
            insertEmail.innerHTML=inputEmail.value;
            insertTel.innerHTML=inputTelefono.value;

            //Subir la data en local storage
            addDataOnLocalStorage()
           
            //
            resetTableValues()

            btnSubmit.setAttribute("value", "submit") 
        }

        function resetTableValues(){
            
            inputName.value="";
            inputLastName.value="";
            inputEmail.value="";
            inputTelefono.value="";
        }

        function deleteRow(row) {
            var index = getRowIndex(row)
            index.parentNode.removeChild(index)           
            deleteRowFromLocal(row)
        }

        function deleteRowFromLocal(row){
            var index = getRowIndex(row)
            var position = index.rowIndex-1
            arr.splice(position,1)
            localStorage.setItem("localData", JSON.stringify(arr))
        }
        
        function editRowValues(row){
            var index = getRowIndex(row)
            var position = index.rowIndex-1
            
            rowPicker=row;
            i=position
            //Jala la informacion de LC
            var name = arr[position].name
            var lname = arr[position].lastName
            var email = arr[position].email
            var tel = arr[position].tel


           //Localizar y colocar los input donde se vera la informacion a modificar
            // var actualname = document.getElementById("name");
            // var actuallname= document.getElementById("lastName");      
            // var actualemail=document.getElementById("email");
            // var actualtel=document.getElementById("Tel")

            inputName.value=name;
            inputLastName.value=lname;
            inputEmail.value=email;
            inputTelefono.value=tel;
            //Cambia el valor del boton y cambiarle el onclick
            
            btnSubmit.setAttribute("value", "Guardar")
            form.setAttribute("onsubmit", "editRowOnLocal(i, rowPicker)")

            // var resetButton = document.getElementById("reset")
            
            btnReset.setAttribute("value" , "Cancelar")

            
            
        }   
 
        function editRowOnLocal(i, row){
            
            // var name = document.getElementById("name").value 
            // var ltname = document.getElementById("lastName").value
            // var email = document.getElementById("email").value
            // var tel = document.getElementById("Tel").value
            var newRow =`{"name":"${inputName.value}", "lastName":"${inputLastName.value}", "email":"${inputEmail.value}", "tel":"${inputTelefono.value}"}`
            var objt = JSON.parse(newRow)
           
            
            arr.splice(i, 1, objt)   
            localStorage.setItem("localData", JSON.stringify(arr))   
            resetear();     
        }

        function resetear()
        {
            // var form = document.getElementById("form")
            form.setAttribute("onsubmit", "addRow()")
            btnReset.setAttribute("value" , "Reset")
        }
        
        function getRowIndex(row){
            var index=row.parentNode.parentNode
            return index;
        }

    </script>
</html>